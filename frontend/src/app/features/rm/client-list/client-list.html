<div class="page-container">

  <!-- Header -->
  <div class="header">
    <div class="header-left">
      <h1>
        <mat-icon>business</mat-icon>
        My Clients
      </h1>
      <span class="client-count">{{ filteredClients.length }} client{{ filteredClients.length !== 1 ? 's' :  '' }}</span>
    </div>
    <div class="header-actions">
      <button 
        mat-stroked-button 
        (click)="toggleFilters()"
        [class.active]="showFilters"
        [matBadge]="activeFilterCount"
        [matBadgeHidden]="activeFilterCount === 0"
        matBadgeColor="accent"
        matBadgeSize="small">
        <mat-icon>{{ showFilters ? 'filter_list_off' : 'filter_list' }}</mat-icon>
        Filters
      </button>
      <button mat-raised-button color="primary" (click)="addNewClient()">
        <mat-icon>add</mat-icon>
        Add Client
      </button>
    </div>
  </div>

  <!-- Compact Filter Section -->
  <div class="filter-section" *ngIf="showFilters" [@slideDown]>
    <mat-card class="filter-card">
      <div class="filter-content">
        
        <!-- Search Field -->
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Search by name</mat-label>
          <input 
            matInput 
            [(ngModel)]="searchName" 
            (ngModelChange)="applyFilters()"
            placeholder="Company name">
          <mat-icon matPrefix>search</mat-icon>
          <button 
            matSuffix 
            mat-icon-button 
            *ngIf="searchName"
            (click)="searchName = ''; applyFilters()"
            matTooltip="Clear">
            <mat-icon>close</mat-icon>
          </button>
        </mat-form-field>

        <!-- Industry Filter -->
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Industry</mat-label>
          <mat-select 
            [(ngModel)]="selectedIndustry" 
            (ngModelChange)="applyFilters()">
            <mat-option value="">All Industries</mat-option>
            <mat-option *ngFor="let industry of industries" [value]="industry">
              {{ industry }}
            </mat-option>
          </mat-select>
          <mat-icon matPrefix>category</mat-icon>
        </mat-form-field>

        <!-- Clear Filters Button -->
        <button 
          mat-button 
          class="clear-btn"
          (click)="clearFilters()"
          [disabled]="activeFilterCount === 0">
          <mat-icon>clear_all</mat-icon>
          Clear All
        </button>
      </div>

      <!-- Active Filters Chips -->
      <div class="active-filters" *ngIf="activeFilterCount > 0">
        <span class="filter-label">Active filters: </span>
        <mat-chip-set>
          <mat-chip *ngIf="searchName" (removed)="searchName = ''; applyFilters()">
            Name:  {{ searchName }}
            <button matChipRemove>
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip>
          <mat-chip *ngIf="selectedIndustry" (removed)="selectedIndustry = ''; applyFilters()">
            Industry: {{ selectedIndustry }}
            <button matChipRemove>
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip>
        </mat-chip-set>
      </div>
    </mat-card>
  </div>

  <!-- Error Message -->
  <div class="error-box" *ngIf="errorMessage">
    <mat-icon>error</mat-icon>
    <span>{{ errorMessage }}</span>
    <button mat-button (click)="loadClients()">Retry</button>
  </div>

  <!-- Loading -->
  <div class="loading" *ngIf="isLoading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading clients...</p>
  </div>

  <!-- No Results -->
  <mat-card class="no-results" *ngIf="! isLoading && filteredClients.length === 0 && !errorMessage">
    <mat-icon>info</mat-icon>
    <h3>No clients found</h3>
    <p *ngIf="activeFilterCount > 0">Try adjusting your filters</p>
    <p *ngIf="activeFilterCount === 0">Get started by adding your first client</p>
    <button mat-raised-button color="primary" (click)="addNewClient()">
      <mat-icon>add</mat-icon>
      Add Client
    </button>
  </mat-card>

  <!-- Clients Table -->
  <mat-card class="table-card" *ngIf="! isLoading && filteredClients.length > 0">
    <table mat-table [dataSource]="filteredClients" class="clients-table">

      <!-- Company Name Column -->
      <ng-container matColumnDef="companyName">
        <th mat-header-cell *matHeaderCellDef>Company</th>
        <td mat-cell *matCellDef="let client">
          <div class="company-cell">
            <mat-icon class="company-icon">business</mat-icon>
            <div>
              <div class="company-name">{{ client.companyName }}</div>
              <div class="company-address">{{ client.address | slice: 0:50 }}...</div>
            </div>
          </div>
        </td>
      </ng-container>

      <!-- Industry Column -->
      <ng-container matColumnDef="industry">
        <th mat-header-cell *matHeaderCellDef>Industry</th>
        <td mat-cell *matCellDef="let client">
          <mat-chip class="industry-chip">{{ client.industry }}</mat-chip>
        </td>
      </ng-container>

      <!-- Contact Column -->
      <ng-container matColumnDef="contact">
        <th mat-header-cell *matHeaderCellDef>Contact</th>
        <td mat-cell *matCellDef="let client">
          <div class="contact-cell">
            <div class="contact-name">{{ client.primaryContact. name }}</div>
            <div class="contact-info">
              <mat-icon>email</mat-icon>
              {{ client.primaryContact.email }}
            </div>
            <div class="contact-info">
              <mat-icon>phone</mat-icon>
              {{ client. primaryContact.phone }}
            </div>
          </div>
        </td>
      </ng-container>

      <!-- Turnover Column -->
      <ng-container matColumnDef="turnover">
        <th mat-header-cell *matHeaderCellDef>Turnover</th>
        <td mat-cell *matCellDef="let client">
          <div class="turnover-cell">
            <span class="currency">â‚¹</span>
            <span class="amount">{{ client.annualTurnover | number:'1.1-1' }}</span>
            <span class="unit">Cr</span>
          </div>
        </td>
      </ng-container>

      <!-- Documents Column -->
      <ng-container matColumnDef="documents">
        <th mat-header-cell *matHeaderCellDef>Documents</th>
        <td mat-cell *matCellDef="let client">
          <mat-chip 
            [class.submitted]="client. documentsSubmitted"
            [class.pending]="! client.documentsSubmitted">
            <mat-icon>{{ client.documentsSubmitted ? 'check_circle' : 'pending' }}</mat-icon>
            {{ client.documentsSubmitted ? 'Submitted' : 'Pending' }}
          </mat-chip>
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let client">
          <button 
            mat-icon-button 
            (click)="viewClient(client)"
            matTooltip="View Details"
            color="primary">
            <mat-icon>visibility</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-row"></tr>
    </table>
  </mat-card>

</div>