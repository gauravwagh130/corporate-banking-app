<div class="page-container">

  <!-- Header -->
  <div class="header">
    <div class="header-left">
      <h1>
        <mat-icon>assignment</mat-icon>
        Credit Requests
      </h1>
      <span class="count">
        {{ filteredRequests.length }} requests
      </span>
    </div>

    <div class="header-actions">
      <button
        mat-stroked-button
        (click)="toggleFilters()"
        [matBadge]="activeFilterCount"
        [matBadgeHidden]="activeFilterCount === 0"
        matBadgeColor="accent">
        <mat-icon>{{ showFilters ? 'filter_list_off' : 'filter_list' }}</mat-icon>
        Filters
      </button>
    </div>
  </div>

  <!-- Filters -->
  <mat-card class="filter-card" *ngIf="showFilters">
    <div class="filter-content">

      <mat-form-field appearance="outline">
        <mat-label>Search</mat-label>
        <input
          matInput
          [(ngModel)]="searchTerm"
          (input)="applyFilters()"
          placeholder="Client ID / Purpose">
        <mat-icon matPrefix>search</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Status</mat-label>
        <mat-select
          [(ngModel)]="selectedStatus"
          (selectionChange)="applyFilters()">
          <mat-option value="">All Status</mat-option>
          <mat-option *ngFor="let s of statuses" [value]="s">
            {{ s }}
          </mat-option>
        </mat-select>
        <mat-icon matPrefix>flag</mat-icon>
      </mat-form-field>

      <button mat-button (click)="clearFilters()" [disabled]="activeFilterCount === 0">
        <mat-icon>clear_all</mat-icon>
        Clear
      </button>

    </div>
  </mat-card>

  <!-- Loading -->
  <div class="loading" *ngIf="isLoading">
    <mat-spinner></mat-spinner>
    <p>Loading credit requests...</p>
  </div>

  <!-- Table -->
  <mat-card class="table-card" *ngIf="!isLoading && filteredRequests.length">
    <table mat-table [dataSource]="filteredRequests">

      <!-- Client ID -->
      <ng-container matColumnDef="clientId">
        <th mat-header-cell *matHeaderCellDef>Client ID</th>
        <td mat-cell *matCellDef="let r">{{ r.clientId }}</td>
      </ng-container>

      <!-- Purpose -->
      <ng-container matColumnDef="purpose">
        <th mat-header-cell *matHeaderCellDef>Purpose</th>
        <td mat-cell *matCellDef="let r">{{ r.purpose }}</td>
      </ng-container>

      <!-- Amount -->
      <ng-container matColumnDef="amount">
        <th mat-header-cell *matHeaderCellDef>Amount</th>
        <td mat-cell *matCellDef="let r">
          â‚¹{{ r.requestAmount / 10000000 | number:'1.2-2' }} Cr
        </td>
      </ng-container>

      <!-- Tenure -->
      <ng-container matColumnDef="tenure">
        <th mat-header-cell *matHeaderCellDef>Tenure</th>
        <td mat-cell *matCellDef="let r">
          {{ r.tenureMonths }} Months
        </td>
      </ng-container>

      <!-- Date -->
      <ng-container matColumnDef="createdAt">
        <th mat-header-cell *matHeaderCellDef>Date</th>
        <td mat-cell *matCellDef="let r">
          {{ r.createdAt | date:'dd MMM yyyy' }}
        </td>
      </ng-container>

      <!-- Status -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let r">
          <mat-chip class="{{ r.status | lowercase }}">
            {{ r.status }}
          </mat-chip>
        </td>
      </ng-container>

      <!-- Actions -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let r">
          <button mat-icon-button color="primary" (click)="viewRequest(r.id)">
            <mat-icon>visibility</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

    </table>
  </mat-card>

  <!-- No Data -->
  <mat-card class="no-results" *ngIf="!isLoading && !filteredRequests.length">
    <mat-icon>info</mat-icon>
    <p>No credit requests found</p>
  </mat-card>

</div>
